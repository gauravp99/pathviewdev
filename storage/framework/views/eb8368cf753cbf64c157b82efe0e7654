<?php
use Illuminate\Cacheche;
?>


<?php $__env->startSection('content'); ?>

<?php echo $__env->make('navigation', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.js"></script>
<script src="js/PathviewApp.js"></script>

    <div class="col-sm-9">

        <div class="conetent-header ">

            <p><b>New Pathway Analysis</b></p>
        </div>

        <div class="col-sm-5">

            <?php if($errors->any()): ?>
                <ul class="alert alert-danger" style="font-size: 14px;list-style-type: none;">
                     <?php foreach($errors->all() as $error): ?>
                        <li><?php echo e($error); ?></li>
                     <?php endforeach; ?>
                 </ul>
            <?php endif; ?>

            <?php if(Session::get('err')!=NULL): ?>

                <ul class="alert alert-danger" style="font-size: 14px;list-style-type: none;">
                    <?php
                    for ($x = 0; $x < sizeof(Session::get('err')); $x++) {
                        echo "<li>" . Session::get('err')[$x] . "</li>";
                    }
                    ?>
                </ul>
            <?php endif; ?>
                <ul id="errors" hidden="true" class="alert alert-danger" style="font-size: 14px;list-style-type: none;"></ul>
        </div>
    </div>


    <?php /*Default/Inital values for the each attribute for the analysis*/ ?>
        <?php
        $gfile = "";
        $cpdfile = "";
        $geneid = "ENTREZ";
        $cpdid = "KEGG";
        $species = "hsa-Homo sapiens";
        $pathway = "00640-Propanoate metabolism";
        $selectpath = "00010-Glycolysis / Gluconeogenesis";
        $pathidx = 0;
        $suffix = "pathview";
        $kegg = true;
        $layer = true;
        $split = false;
        $expand = false;
        $multistate = true;
        $matchd = true;
        $gdisc = false;
        $cdisc = false;
        $kpos = "topright";
        $pos = "bottomleft";
        $offset = "1.0";
        $align = "y";
        $glmt = 1;
        $gbins = 10;
        $glow = "green";
        $gmid = "grey";
        $ghigh = "red";
        $clmt = 1;
        $cbins = 10;
        $clow = "blue";
        $cmid = "grey";
        $chigh = "yellow";
        $nsum = "sum";
        $ncolor = "transparent";
        $compare = "paired";
        ?>

    <?php /*Div for Form for generating the analysis Form is devided into pages
    1. Input and Output
    2. Graphics
    3. Coloration */ ?>

    <div class="col-sm-7">
        <div id="content" ng-app="PathviewApp">
         <div id="wrapper" ng-controller="analysisController">
            <div id="navigation" style="display:none;">
                <ul>
                    <li class="selected">
                        <a href="#">Input & Output</a>
                    </li>
                    <li>
                        <a href="#">Graphics</a>
                    </li>
                    <li>
                        <a href="#">Coloration</a>
                    </li>

                </ul>
            </div>



            <?php /*Input and Output slider */ ?>
            <div id="steps">

                <?php /*Form Method: POST Action:postAnalysis with internally leads to AnalysisController Controller*/ ?>

                <?php echo form::open(array('url' => 'postAnalysis','enctype' => 'multipart/form-data','method'=>'POST','files'=>true,'id' => 'anal_form')); ?>



                <fieldset class="step">
                    <input type="hidden" id="page_is_dirty" name="page_is_dirty" value="0"/>

                    <div class="stepsdiv" id="gfile-div" <?php if(isset(Session::get('err_atr')['gfile'])): ?>
                         style="background-color:#DA6666;" <?php endif; ?>>
                        <div class="col-sm-12">

                            <div class="col-sm-5">
                                <a href="tutorial#gene_data" onclick="window.open('tutorial#gene_data', 'newwindow', 'width=300, height=250').focus() ;return false;" title="Gene Data accepts data matrices in tab- or comma-delimited format (txt or csv)." target="_blank" class="scrollToTop" style="float:left;margin-right:5px;">
                                    <span class="glyphicon glyphicon-info-sign" style="margin-right: 20px;"></span>
                                </a>
                                <?php echo form::label('gfile','Gene Data:'); ?>

                            </div>

                            <div class="col-sm-7" >
                                <div class="col-sm-2" style="font-size: 12px;visibility:hidden;margin-top:10px;" id="edit">
                                <a href=""><span class="glyphicon glyphicon-edit" id="geneMenu" data-toggle="modal" data-target="#GenemyModal" >Edit</span></a>
                                <a href=""><span class="glyphicon glyphicon-trash" id="clearFile" onclick="reset($('#assayData'))" >Remove</span></a>
                                    </div>
                                <div class="col-sm-10">
                            <?php echo form::file('gfile',$attributes = array('id' => 'assayData','on-read-file' => 'showGeneContent($fileContent,"gene")', 'ng-click'=>'delete()','data-toggle'=>"modal",'data-target'=>"#GenemyModal")); ?>

</div>
                                </div>
                            <div class="modal fade" id="GenemyModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
                                 aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span></button>
                                            <h4 class="modal-title " id="ModalLabel">Gene data</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="col-sm-12">
                                                <div class="col-md-6">
                                                    <input type="text" name="generef" ng-model="geneRefSelect">
                                                    <select name="GeneRef[]" id="Generefselect"   multiple="" size="10" style="width:100%;" ng-model='geneRefSelect' ng-show="Genecolumns.length > 0">
                                                        <option ng-repeat="column in Genecolumns track by $index"
                                                                value="<% $index+1 %>">
                                                            <% column %>
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <input type="text" name="genesam" ng-model="geneSamSelect">
                                                    <select name="GeneSam[]" id="Genesamselect"   multiple="" size="10" style="width:100%;" ng-model='geneSamSelect' ng-show="Genecolumns.length > 0">
                                                        <option ng-repeat="column in Genecolumns track by $index"
                                                                value="<% $index+1 %>">
                                                            <% column %>
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="col-sm-5">
                                                    <a href="gageTutorial#compare" onclick="window.open('gageTutorial#compare', 'newwindow', 'width=300, height=250').focus() ;return false;" title="Comparison scheme to be used." target="_blank" class="scrollToTop" style="float:left;margin-right:5px;">
                                                        <span class="glyphicon glyphicon-info-sign" style="margin-right: 20px;"></span>
                                                    </a>
                                                    <label for="compare">Compare:</label>
                                                </div>
                                                <div class="col-sm-7">
                                                    <p style="display: inline;margin-right:10px;">Paired</p> <input style="display: inline!important;" type="checkbox" name="genecompare" ng-model="GeneCompare" ng-init="checked=true" checked="">
                                                   <!-- <select  name="genecompare"  class="styled-select" id="compare" class="compare" ng-model="GeneCompare" >
                                                        <option value="paired" <?php if(strcmp($compare,'paired') == 0 ): ?> selected <?php endif; ?> >paired</option>
                                                        <option value="unpaired" <?php if(strcmp($compare,'unpaired') == 0 ): ?> selected <?php endif; ?> >unpaired</option>
                                                        <option value="1ongroup" <?php if(strcmp($compare,'1ongroup') == 0 ): ?> selected <?php endif; ?>>1ongroup</option>
                                                        <option value="as.group" <?php if(strcmp($compare,'as.group') == 0 ): ?> selected <?php endif; ?> >as.group</option>
                                                    </select> -->
                                                </div>
                                            </div>

                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" id="gfilePopUp" class="btn btn-default" data-dismiss="modal">Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <input type="text"  name="NoOfColumns" value="<% Genecolumns.length %>" hidden="" id="NoOfColumns"   >
                        </div>
                    </div>


                    <div class="stepsdiv" id="cfile-div" <?php if(isset(Session::get('err_atr')['cfile'])): ?> style="background-color:#DA6666;" <?php endif; ?>>
                        <div class="col-sm-12">
                            <div class="col-sm-5">
                                <a href="tutorial#cpd_data"  onclick="window.open('tutorial#cpd_data', 'newwindow', 'width=300, height=250').focus();return false;" id="cfile" title="Compound Data accepts data matrices in tab- or comma-delimited format (txt or csv)." target="_blank" class="scrollToTop" style="float:left;margin-right:5px;">
                                    <span class="glyphicon glyphicon-info-sign" style="margin-right: 20px;"></span>
                                </a>
                                <?php echo form::label('cpdfile','Compound Data:'); ?>

                            </div>
                            <div class="col-sm-7" style="display: inline-block;">
                                <div class="col-sm-2" style="font-size: 12px;visibility:hidden;margin-top:10px;" id="cpdedit">
                                    <a href=""><span class="glyphicon glyphicon-edit" id="compoundMenu" data-toggle="modal" data-target="#myModal" >Edit</span></a>
                                    <a href=""><span class="glyphicon glyphicon-trash" id="clearFile" onclick="reset($('#cpdassayData'))" >Remove</span></a>
                                </div>
                                <div class="col-sm-10">
                                <?php echo form::file('cpdfile', $attributes = array('id' => 'cpdassayData','on-read-file' => 'showCompoundContent($fileContent,"compound")', 'ng-click'=>'delete()','data-toggle'=>"modal",'data-target'=>"#myModal")); ?>

                            </div>
                                </div>
                        </div>

                    </div>

                    <!-- Modal -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title " id="myModalLabel">Compound data</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="col-sm-12">
                                    <div class="col-md-6">
                                        <input type="text" name="cpdref" ng-model="cpdRefSelect">
                                        <select name="CompoundRef[]" id="Cpdrefselect"   multiple="" size="10" style="width:100%;" ng-model='cpdRefSelect' ng-show="Compoundcolumns.length > 0">
                                            <option ng-repeat="column in Compoundcolumns track by $index"
                                                    value="<% $index+1 %>">
                                                <% column %>
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" name="cpdsam" ng-model="cpdSamSelect">
                                        <select name="CompoundSam[]" id="Cpdsamselect"   multiple="" size="10" style="width:100%;" ng-model='cpdSamSelect' ng-show="Compoundcolumns.length > 0">
                                            <option ng-repeat="column in Compoundcolumns track by $index"
                                                    value="<% $index+1 %>">
                                                <% column %>
                                            </option>
                                        </select>
                                    </div>
                                        </div>
                                    <div class="col-sm-12">
                                        <div class="col-sm-5">
                                            <a href="gageTutorial#compare" onclick="window.open('gageTutorial#compare', 'newwindow', 'width=300, height=250').focus() ;return false;" title="Comparison scheme to be used." target="_blank" class="scrollToTop" style="float:left;margin-right:5px;">
                                                <span class="glyphicon glyphicon-info-sign" style="margin-right: 20px;"></span>
                                            </a>
                                            <label for="compare">Compare:</label>
                                        </div>
                                        <div class="col-sm-7">
                                            <p style="display: inline;margin-right:10px;">Paired</p> <input style="display: inline;" type="checkbox" name="cpdCompare" ng-model="CpdCompare" ng-init="checked=true" checked="true">

                                            <!--<select  name="cpdcompare"  class="styled-select" id="compare" class="compare" ng-model="CpdCompare" >
                                                <option value="paired" <?php if(strcmp($compare,'paired') == 0 ): ?> selected <?php endif; ?> >paired</option>
                                                <option value="unpaired" <?php if(strcmp($compare,'unpaired') == 0 ): ?> selected <?php endif; ?> >unpaired</option>
                                                <option value="1ongroup" <?php if(strcmp($compare,'1ongroup') == 0 ): ?> selected <?php endif; ?>>1ongroup</option>
                                                <option value="as.group" <?php if(strcmp($compare,'as.group') == 0 ): ?> selected <?php endif; ?> >as.group</option>
                                            </select> -->
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" id="gfilePopUp" class="btn btn-default" data-dismiss="modal">Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <?php echo $__env->make('analysis', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
    </div>
    </div>

    </div>



    <script type="text/javascript">

        var pathway_array = [];
        var species_array = [];
        var gene_array = [];
        var cmpd_array = [];
        <?php
          $pathway = Cache::remember('Pathway_id', 10, function()
                {
                    return DB::table('Pathway')->get(array('pathway_id'));
                });
                if (Cache::has('Pathway_id'))
                {
                    $pathway = Cache::get('Pathway_id');
                }
        ?>
        <?php
            $species = Cache::remember('Species_id', 10, function()
                {
                    return DB::table('Species')->get(array('species_id'));
                });
                if (Cache::has('Species_id'))
                {
                    $species = Cache::get('Species_id');
                }
        ?>
        <?php
         $gene = Cache::remember('gene_id', 10, function()
                {
                    return DB::table('gene')->get(array('geneid'));;
                });
                if (Cache::has('gene_id'))
                {
                    $gene = Cache::get('gene_id');
                }
         $gene = DB::table('gene')->get(array('geneid'));?>
        <?php
        $cmpd = Cache::remember('compound_id', 10, function()
                {
                    return DB::table('compound')->get(array('cmpdid'));;
                });
                if (Cache::has('compound_id'))
                {
                    $cmpd = Cache::get('compound_id');
                }
            ?>
        pathway_array = <?php echo JSON_encode($pathway);?>;
        species_array = <?php echo JSON_encode($species);?>;
        gene_array = <?php echo JSON_encode($gene);?>;
        cmpd_array = <?php echo JSON_encode($cmpd);?>;


        }

        $(document).ready(function() {

            $('#myModal').on('hide.bs.modal', function (e) {
                $('#myModal').addClass('bounceOutRight');
                return e.preventDefault();
            });


        };
    </script>

    <script src="<?php echo e(asset('/js/newanalysis.js')); ?>"></script>
    <script>

        window.reset = function (e) {
            console.log("in reset function");
            e.wrap('<form>').closest('form').get(0).reset();
            e.unwrap();
        }

    </script>
<?php $__env->stopSection(); ?>


<?php echo $__env->make('app', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>